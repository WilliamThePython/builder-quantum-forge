<!doctype html>
<html lang="en">
  <head>
    <!-- CRITICAL: Fix FullStory namespace conflict FIRST - Must be before any other scripts -->
    <script>
      // Aggressive FullStory namespace fix - runs immediately
      (function () {
        // Set namespace immediately to prevent conflicts
        window["_fs_namespace"] = "FS_INTELLIMESH";

        // Also try to prevent the default namespace from being used
        Object.defineProperty(window, "_fs_namespace", {
          value: "FS_INTELLIMESH",
          writable: false,
          configurable: false,
        });

        // Initialize the namespace object
        window.FS_INTELLIMESH = window.FS_INTELLIMESH || {};

        // Block FullStory from loading without namespace
        const originalDefineProperty = Object.defineProperty;
        Object.defineProperty = function (obj, prop, descriptor) {
          if (
            prop === "_fs_namespace" &&
            descriptor.value !== "FS_INTELLIMESH"
          ) {
            console.warn("Blocking FullStory namespace conflict");
            descriptor.value = "FS_INTELLIMESH";
          }
          return originalDefineProperty.call(this, obj, prop, descriptor);
        };

        console.log("FullStory namespace set to:", window["_fs_namespace"]);
      })();
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Intellimesh.pro - Intelligent 3D Mesh Processing & Fabrication
    </title>
    <meta
      name="description"
      content="Professional 3D mesh processing with Open3D quadric decimation, coplanar face merging, and intelligent parts export. STL/OBJ support for creators and engineers."
    />
    <meta
      name="keywords"
      content="Intellimesh, 3D mesh processing, quadric decimation, STL viewer, OBJ editor, mesh simplification, 3D fabrication, parts export, Open3D"
    />

    <!-- Additional FullStory conflict prevention -->
    <script>
      // Double-check namespace is still set and prevent any overrides
      (function () {
        if (window["_fs_namespace"] !== "FS_INTELLIMESH") {
          console.warn("FullStory namespace was overridden, resetting...");
          window["_fs_namespace"] = "FS_INTELLIMESH";
        }

        // Intercept any attempts to load FullStory without proper namespace
        const originalAppendChild = document.head.appendChild;
        document.head.appendChild = function (child) {
          if (
            child.tagName === "SCRIPT" &&
            (child.src?.includes("fullstory") || child.src?.includes("fs.js"))
          ) {
            console.warn(
              "Intercepted FullStory script load, ensuring namespace is set",
            );
            window["_fs_namespace"] = "FS_INTELLIMESH";
          }
          return originalAppendChild.call(this, child);
        };
      })();
    </script>

    <!-- Google Analytics 4 -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-XXXXXXXXXX", {
        anonymize_ip: true,
        allow_ad_personalization_signals: false,
      });
    </script>

    <!-- Google AdSense - Replace with your actual publisher ID -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXX"
      crossorigin="anonymous"
    ></script>

    <!-- AdSense Auto Ads (optional) -->
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-XXXXXXXXXX",
        enable_page_level_ads: true,
      });
    </script>
  </head>

  <body>
    <div id="root"></div>

    <script type="module" src="/client/App.tsx"></script>
  </body>
</html>
